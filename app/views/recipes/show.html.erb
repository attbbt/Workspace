<%= render 'shared/page_title', title: @recipe.name.upcase %>

<div class="row">
  <div class="col-md-4 pull-right center">
    <% if @recipe.chef.picture? %>
      <%= link_to image_tag(@recipe.chef.picture.url, size:"300x300", class: 'gravatar'), chef_path(@recipe.chef) %>
    <% else %>
      <%= link_to image_tag('missing.png', size:"300x300", class: 'gravatar'), chef_path(@recipe.chef) %>
    <% end %>
    <p>
      <h5>Brought to you by: <%=@recipe.chef.name %></h5>
    </p>
  </div>
  <div class="col-md-8 left">
    <h3><%= @recipe.summary %>
    <% if logged_in? and @recipe.chef == current_user %>
      <%= link_to "Edit Recipe", edit_recipe_path(@recipe), class: 'btn btn-success pull-right' %></h3>
    <% end %>
    <hr/>
    <div class="show_pic">
      <%= image_tag(@recipe.picture.url, size:"350x200", class: 'gravatar') if @recipe.picture? %>
    </div>
    <div class="well">
      <% if @recipe.styles.any? %>
        <p>Styles: <%= render @recipe.styles %></p>
      <% end %>
      <% if @recipe.ingredients.any? %>
        <p>Ingredients: <%= render @recipe.ingredients %></p>
      <% end %>
      <p style="font-family:verdana"><strong>Steps:</strong></p>
      <p><%= simple_format(@recipe.description) %></p>
      <div class="pull-right">
        <%= link_to like_recipe_path(@recipe, like:true), method: :post do %>
          <i class="glyphicon glyphicon-thumbs-up"></i>&nbsp <%= @recipe.thumbs_up_total %>
        <% end %> &nbsp;&nbsp;&nbsp;&nbsp;
        <%= link_to like_recipe_path(@recipe, like:false), method: :post do %>
          <i class="glyphicon glyphicon-thumbs-down"></i>&nbsp <%= @recipe.thumbs_down_total %>
        <% end %>&nbsp;&nbsp;</br>
        <div id='social-share'><%= social_share_button_tag(@recipe.name, :popup => "true") %></div>
      </div><br><br>
    </div>
    <%= link_to "Write a Review", new_recipe_comment_path(@recipe),class: 'btn btn-warning btn-small' %>
    <%= link_to 'Return to Recipes Listing', recipes_path, class: 'btn btn-warning btn-small pull-right', id: 'return-index' %>
    <hr/>
    <h4><strong>Comments:</strong></h4>
      <P>Average Rating: </P>
      <div class="star-rating" data-score= <%= @avg_rating %> ></div>
    <div class="well">
      <% if @recipe.comments.any? %>
        <% @recipe.comments.each do |comment| %>
          <div class="well well-sm">
          <div class="row">
            <div class='col-sm-2 center'id='comment-img'>
              <% if @recipe.chef.picture? %>
                <%= link_to image_tag(comment.chef.picture.url, size:"80x80", class: 'img-circle'), chef_path(comment.chef) %>
              <% else %>
                <%= link_to image_tag('missing.png', size:"80x80", class: 'img-circle'), chef_path(comment.chef) %>
              <% end %>
            </div>
            <div class='col-sm-6 left' id="comment-name">
              <h4><strong><%= comment.chef.name.capitalize %></strong></h4>
              <small class="quite"> posted: <%= time_ago_in_words(comment.created_at) %> ago</small>
              <div class="star-rating" data-score= <%= comment.rating %> ></div>
            </div>
            <div class="col-sm-4">
              <% if logged_in? and comment.chef == current_user %>
                <%= link_to "Edit Review", edit_recipe_comment_path(@recipe,comment),class: 'btn btn-default btn-small pull-right' %>
              <% end %>
            </div>
          </div></br>
          <p><%= comment.content %></p>
          </div>
        <% end %>
      <% else %>
        <h3>No reviews just yet, would you like to add the first!</h3>
      <% end %>
    </div>
  </div>
</div></br></br></br></br>

<script>
    $('.star-rating').raty({
      path: '/assets/',
      readOnly: true,
      score: function() {
            return $(this).attr('data-score');
    }
  });
</script>
